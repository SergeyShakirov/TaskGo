<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TaskGo - DeepSeek AI Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
      }
      .container {
        background: #f5f5f5;
        padding: 20px;
        border-radius: 8px;
        margin: 10px 0;
      }
      button {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
      }
      button:hover {
        background: #0056b3;
      }
      textarea {
        width: 100%;
        height: 100px;
        margin: 10px 0;
      }
      .result {
        background: white;
        padding: 15px;
        border-radius: 4px;
        margin: 10px 0;
        border: 1px solid #ddd;
      }
      .loading {
        color: #666;
        font-style: italic;
      }
      .error {
        color: red;
      }
      .success {
        color: green;
      }
    </style>
  </head>
  <body>
    <h1>ü§ñ TaskGo - DeepSeek AI Test</h1>

    <div class="container">
      <h3>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è</h3>
      <textarea id="description" placeholder="–û–ø–∏—à–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç...">
–°–æ–∑–¥–∞—Ç—å –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∑–∞–∫–∞–∑–∞ –µ–¥—ã —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π</textarea
      >
      <button onclick="generateDescription()">üöÄ –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –¢–ó</button>
      <div id="result1" class="result" style="display: none"></div>
    </div>

    <div class="container">
      <h3>–û—Ü–µ–Ω–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞</h3>
      <textarea id="estimateDesc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –æ—Ü–µ–Ω–∫–∏...">
–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ CRM —Å–∏—Å—Ç–µ–º—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞–º–∏</textarea
      >
      <button onclick="estimateProject()">üí∞ –û—Ü–µ–Ω–∏—Ç—å –ø—Ä–æ–µ–∫—Ç</button>
      <div id="result2" class="result" style="display: none"></div>
    </div>

    <div class="container">
      <h3>–ê–Ω–∞–ª–∏–∑ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏</h3>
      <textarea id="complexityDesc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞...">
–°–æ–∑–¥–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è —Å –±–ª–æ–∫—á–µ–π–Ω –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π</textarea
      >
      <button onclick="analyzeComplexity()">üéØ –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ–∂–Ω–æ—Å—Ç—å</button>
      <div id="result3" class="result" style="display: none"></div>
    </div>

    <script>
      const API_BASE = "http://localhost:3001/api/ai";

      async function makeRequest(endpoint, data) {
        try {
          const response = await fetch(`${API_BASE}${endpoint}`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
          });
          return await response.json();
        } catch (error) {
          return { success: false, error: error.message };
        }
      }

      async function generateDescription() {
        const resultDiv = document.getElementById("result1");
        const description = document.getElementById("description").value;

        resultDiv.style.display = "block";
        resultDiv.innerHTML =
          '<div class="loading">ü§ñ DeepSeek –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ...</div>';

        const result = await makeRequest("/generate-description", {
          briefDescription: description,
        });

        if (result.success) {
          resultDiv.innerHTML = `
                    <div class="success">‚úÖ –£—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ!</div>
                    <h4>üìù –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ:</h4>
                    <p>${result.data.detailedDescription}</p>
                    <h4>üìä –û—Ü–µ–Ω–∫–∞:</h4>
                    <ul>
                        <li>‚è±Ô∏è –í—Ä–µ–º—è: ${result.data.estimatedHours} —á–∞—Å–æ–≤</li>
                        <li>üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å: ${result.data.estimatedCost?.toLocaleString()} —Ä—É–±.</li>
                        <li>üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏: ${
                          result.data.technologies?.join(", ") || "–Ω–µ —É–∫–∞–∑–∞–Ω—ã"
                        }</li>
                    </ul>
                    <h4>üéØ –≠—Ç–∞–ø—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:</h4>
                    <ul>${
                      result.data.suggestedMilestones
                        ?.map((m) => `<li>${m}</li>`)
                        .join("") || "<li>–≠—Ç–∞–ø—ã –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã</li>"
                    }</ul>
                `;
        } else {
          resultDiv.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞: ${
            result.error || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"
          }</div>`;
        }
      }

      async function estimateProject() {
        const resultDiv = document.getElementById("result2");
        const description = document.getElementById("estimateDesc").value;

        resultDiv.style.display = "block";
        resultDiv.innerHTML =
          '<div class="loading">ü§ñ DeepSeek –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç –ø—Ä–æ–µ–∫—Ç...</div>';

        const result = await makeRequest("/estimate", { description });

        if (result.success) {
          resultDiv.innerHTML = `
                    <div class="success">‚úÖ –û—Ü–µ–Ω–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</div>
                    <ul>
                        <li>‚è±Ô∏è –í—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏: ${result.data.hours} —á–∞—Å–æ–≤</li>
                        <li>üí∞ –ü—Ä–∏–º–µ—Ä–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${result.data.cost?.toLocaleString()} —Ä—É–±.</li>
                        <li>üéØ –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: ${result.data.complexity}</li>
                    </ul>
                `;
        } else {
          resultDiv.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞: ${
            result.error || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"
          }</div>`;
        }
      }

      async function analyzeComplexity() {
        const resultDiv = document.getElementById("result3");
        const description = document.getElementById("complexityDesc").value;

        resultDiv.style.display = "block";
        resultDiv.innerHTML =
          '<div class="loading">ü§ñ DeepSeek –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç—å...</div>';

        const result = await makeRequest("/analyze-complexity", {
          description,
        });

        if (result.success) {
          resultDiv.innerHTML = `
                    <div class="success">‚úÖ –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω!</div>
                    <h4>üéØ –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: ${result.data.complexity}</h4>
                    <h4>‚ö†Ô∏è –§–∞–∫—Ç–æ—Ä—ã —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:</h4>
                    <ul>${
                      result.data.factors
                        ?.map((f) => `<li>${f}</li>`)
                        .join("") || "<li>–§–∞–∫—Ç–æ—Ä—ã –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã</li>"
                    }</ul>
                    <h4>üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</h4>
                    <ul>${
                      result.data.recommendations
                        ?.map((r) => `<li>${r}</li>`)
                        .join("") || "<li>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</li>"
                    }</ul>
                `;
        } else {
          resultDiv.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞: ${
            result.error || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"
          }</div>`;
        }
      }
    </script>
  </body>
</html>
